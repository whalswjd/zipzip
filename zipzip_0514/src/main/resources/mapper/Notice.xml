<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="Notice">

	<insert id="insert" parameterType="com.example.demo.dto.Notice" useGeneratedKeys="true" keyProperty="noticeNum">
		<selectKey resultType="long" keyProperty="noticeNum" order="BEFORE">
			SELECT ZIP_NOTICE_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO ZIP_NOTICE (
		    NOTICE_NUM,
		    USER_ID,
		    NOTICE_TITLE,
		    NOTICE_CONTENT,
		    NOTICE_HIT,
		    REG_DATE
		) VALUES (
		    #{noticeNum},
		    #{userId},
		    #{noticeTitle},
		    #{noticeContent},
		    0,
		    SYSDATE
		)
	</insert>
	
	<insert id="insertFile" parameterType="com.example.demo.dto.Notice">
		<selectKey resultType="long" keyProperty="fileNum" order="BEFORE">
			SELECT ZIP_NOTICE_FILE_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO ZIP_NOTICE_FILE (
		    NOTICE_NUM,
		    FILE_NUM,
		    FILE_IDX,
		    FILE_ORG,
		    FILE_NAME,
		    FILE_DATE
		) VALUES (
		    #{noticeNum},
		    #{fileNum},
		    #{fileIdx},
		    #{fileOrg},
		    #{fileName},
		    SYSDATE
		)
	</insert>
	
	<select id="selectAll" resultType="com.example.demo.dto.Notice">
		SELECT NOTICE_NUM,
		    USER_ID,
		    NOTICE_TITLE,
		    NOTICE_CONTENT,
		    NOTICE_HIT,
		    TO_CHAR(REG_DATE, 'YYYY-MM-DD') REG_DATE
		FROM ZIP_NOTICE
		ORDER BY NOTICE_NUM DESC
	</select>
	
	<update id="updateHit" parameterType="long">
		UPDATE ZIP_NOTICE
		SET NOTICE_HIT = NOTICE_HIT + 1
		WHERE NOTICE_NUM = #{noticeNum}
	</update>
	
	<select id="selectOne" parameterType="long" resultType="com.example.demo.dto.Notice">
		SELECT NOTICE_NUM,
		    USER_ID,
		    NOTICE_TITLE,
		    NOTICE_CONTENT,
		    NOTICE_HIT,
		    TO_CHAR(REG_DATE, 'YYYY-MM-DD') REG_DATE
		FROM ZIP_NOTICE
		WHERE NOTICE_NUM = #{noticeNum}
	</select>
	
	<update id="update">
		UPDATE ZIP_NOTICE
		SET NOTICE_TITLE = #{noticeTitle},
			NOTICE_CONTENT = #{noticeContent}
		WHERE NOTICE_NUM = #{noticeNum}
	</update>
	
	<delete id="delete" parameterType="long">
		DELETE FROM ZIP_NOTICE
		WHERE NOTICE_NUM = #{noticeNum}
	</delete>
	
	<select id="selectFile" parameterType="long" resultType="com.example.demo.dto.NoticeFile">
		SELECT NOTICE_NUM,
		    FILE_NUM,
		    FILE_IDX,
		    FILE_ORG,
		    FILE_NAME,
		    FILE_DATE
		FROM ZIP_NOTICE_FILE
		WHERE NOTICE_NUM = #{noticeNum}
	</select>
	
</mapper>